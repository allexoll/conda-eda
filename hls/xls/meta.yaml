# Use `conda-build-prepare` before building for a better version string.
{% set version = '%s_%04i_%s'|format(GIT_DESCRIBE_TAG|replace('v', '') or '0.X.X', GIT_DESCRIBE_NUMBER|int, GIT_DESCRIBE_HASH or 'gUNKNOWN') %}

package:
  name: xls
  version: {{ version }}

source:
  - git_url: https://github.com/google/xls.git
    git_rev: main
    patches:
      - add-dist-rule.patch
      - skip-python-requirements.patch

build:
  # number: 202202082028
  number: {{ environ.get('DATE_NUM') }}
  # string: 20220208_2028
  string: {{ environ.get('DATE_STR') }}
  script_env:
    - CI

requirements:
  build:
    - bazel
  host:
    - python
    - pip
    - pycparser
    - Flask
    - Jinja2
    - werkzeug
    - itsdangerous
    - click
    - protobuf
    - numpy
    - scipy
test:
  commands:
    interpreter_main --version
    ir_converter_main --version
    opt_main --version
    codegen_main --version
